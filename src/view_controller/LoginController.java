package view_controller;

import java.net.URL;
import java.time.ZoneId;
import java.time.format.TextStyle;
import java.util.ArrayList;
import java.util.List;
import java.util.Locale;
import java.util.ResourceBundle;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.control.PasswordField;
import javafx.scene.control.TextField;
import utils.ErrorHandler;

public class LoginController implements Initializable {

  private ResourceBundle resources;

  @FXML
  private Label userNameLabel;

  @FXML
  private TextField userNameField;

  @FXML
  private Label passwordLabel;

  @FXML
  private PasswordField passwordField;

  @FXML
  private Button loginButton;

  @FXML
  private Label loginZone;

  @FXML
  private Label loginErrorMessage;

  @Override
  public void initialize(URL location, ResourceBundle resources) {
    this.resources = resources;
    detectZoneID();
  }


  /**
   * Sends request to server to validate provided login credentials for user
   * and password fields.
   *
   * @param event Event generated by user pushing loginButton.
   * @return True if credentials are matched, false otherwise.
   */
  @FXML
  private boolean verifyLogin(ActionEvent event) {
    boolean valid = true;
    String user = userNameField.getText();
    String password = passwordField.getText();
    List<String> errorMessages = new ArrayList<>();

    if(user.isEmpty() || password.isEmpty()) {
      errorMessages.add("User Name and Password must be filled in.");
      ErrorHandler.warningPopup("Invalid Credentials",errorMessages);
      valid = false;
    }
    return valid;
  }

  private void detectZoneID() {
    ZoneId zoneID = ZoneId.systemDefault();
    String zoneText = zoneID.getDisplayName(TextStyle.SHORT, Locale.getDefault()) + "-" +
        zoneID.getDisplayName(TextStyle.FULL, Locale.getDefault());
    loginZone.setText(zoneText);
  }
}